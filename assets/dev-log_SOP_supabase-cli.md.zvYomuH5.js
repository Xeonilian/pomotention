import{_ as i,c as a,o as l,ag as e}from"./chunks/framework.Cs5y-aXb.js";const c=JSON.parse('{"title":"Supabase 本地开发环境搭建与连接 SOP（Windows）","description":"","frontmatter":{},"headers":[],"relativePath":"dev-log/SOP/supabase-cli.md","filePath":"dev-log/SOP/supabase-cli.md","lastUpdated":1767957056000}'),t={name:"dev-log/SOP/supabase-cli.md"};function p(h,s,n,k,o,d){return l(),a("div",null,s[0]||(s[0]=[e(`<h1 id="supabase-本地开发环境搭建与连接-sop-windows" tabindex="-1">Supabase 本地开发环境搭建与连接 SOP（Windows） <a class="header-anchor" href="#supabase-本地开发环境搭建与连接-sop-windows" aria-label="Permalink to &quot;Supabase 本地开发环境搭建与连接 SOP（Windows）&quot;">​</a></h1><p>目标：在 Windows 上用 WSL2 + Docker + Supabase CLI 搭建本地环境；编辑与查看数据库主要使用 Supabase Studio。VSCode 插件仅作为“只读/只查看”可选项。</p><h2 id="_0-打开-普通权限-powershell" tabindex="-1">0. 打开“普通权限” PowerShell <a class="header-anchor" href="#_0-打开-普通权限-powershell" aria-label="Permalink to &quot;0. 打开“普通权限” PowerShell&quot;">​</a></h2><ul><li>推荐：Win + R → 输入 powershell → 回车（标题栏不应显示“管理员”）</li><li>若无法启动普通权限 PowerShell，使用：<div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">runas </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">trustlevel:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0x20000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;powershell&quot;</span></span></code></pre></div></li></ul><h2 id="_1-安装-wsl2-docker-desktop-依赖" tabindex="-1">1. 安装 WSL2（Docker Desktop 依赖） <a class="header-anchor" href="#_1-安装-wsl2-docker-desktop-依赖" aria-label="Permalink to &quot;1. 安装 WSL2（Docker Desktop 依赖）&quot;">​</a></h2><ol><li>启用 Windows 功能（控制面板 → 程序 → 启用或关闭 Windows 功能）：</li></ol><ul><li>勾选 “适用于 Linux 的 Windows 子系统”</li><li>勾选 “虚拟机平台”</li></ul><ol start="2"><li>安装与初始化（管理员 PowerShell）：</li></ol><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">wsl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">install</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">wsl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">list </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">online</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">wsl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">install </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">d Ubuntu</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">22.04</span></span></code></pre></div><p>首次进入 Linux，创建用户名与密码。</p><h2 id="_2-安装-docker-desktop-建议非-c-盘" tabindex="-1">2. 安装 Docker Desktop（建议非 C 盘） <a class="header-anchor" href="#_2-安装-docker-desktop-建议非-c-盘" aria-label="Permalink to &quot;2. 安装 Docker Desktop（建议非 C 盘）&quot;">​</a></h2><ol><li><p>下载 Docker Desktop 安装包</p></li><li><p>自定义路径安装（PowerShell 到安装包目录）：</p></li></ol><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;.\\Docker Desktop Installer.exe&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> \`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  install </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">accept</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">license </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">\`</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  --</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">installation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;E:\\Program Files\\Docker&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> \`</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  --</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">wsl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">root</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;E:\\Program Files\\Docker\\data&quot;</span></span></code></pre></div><ul><li>建议预留 10–20 GB 可用磁盘空间</li><li>设置：Settings → Resources → WSL integration → 勾选你的发行版（如 Ubuntu-22.04）</li><li>确保为 Linux containers 模式（默认）</li></ul><h2 id="_3-安装-supabase-cli-通过-scoop" tabindex="-1">3. 安装 Supabase CLI（通过 Scoop） <a class="header-anchor" href="#_3-安装-supabase-cli-通过-scoop" aria-label="Permalink to &quot;3. 安装 Supabase CLI（通过 Scoop）&quot;">​</a></h2><ol><li>普通 PowerShell：</li></ol><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Set-ExecutionPolicy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ExecutionPolicy RemoteSigned </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Scope CurrentUser</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Invoke-RestMethod</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Uri https:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">//</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">get.scoop.sh </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Invoke-Expression</span></span></code></pre></div><ol start="2"><li>安装 Supabase CLI：</li></ol><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scoop bucket add supabase https:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">//</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">github.com</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">supabase</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scoop</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bucket.git</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scoop install supabase</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">supabase </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">version</span></span></code></pre></div><p>若命令不可用，重启终端或 VSCode。</p><h2 id="_4-项目初始化与云端关联" tabindex="-1">4. 项目初始化与云端关联 <a class="header-anchor" href="#_4-项目初始化与云端关联" aria-label="Permalink to &quot;4. 项目初始化与云端关联&quot;">​</a></h2><p>在你的项目根目录执行：</p><ol><li>登录：</li></ol><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">supabase login</span></span></code></pre></div><ol start="2"><li>初始化本地项目（创建 supabase/ 目录）：</li></ol><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">supabase init</span></span></code></pre></div><ol start="3"><li>关联云端项目（写入 project-ref，确保后续 push 到正确云端）：</li></ol><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">supabase link </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">project</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ref </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">你的项目ID</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><p>项目 ID：Supabase 控制台 → Project Settings → General。</p><p>说明：</p><ul><li>推荐顺序：login → init → link → start</li><li>关于顺序差异：先 start 再 link 也可，但 start 仅启动本地容器；link 决定 db push/pull 的云端目标。为避免误操作，先 link 更清晰。</li></ul><h2 id="_5-启动、诊断与资源控制-本地-docker-服务" tabindex="-1">5. 启动、诊断与资源控制（本地 Docker 服务） <a class="header-anchor" href="#_5-启动、诊断与资源控制-本地-docker-服务" aria-label="Permalink to &quot;5. 启动、诊断与资源控制（本地 Docker 服务）&quot;">​</a></h2><ol><li>启动本地服务：</li></ol><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">supabase start</span></span></code></pre></div><ol start="2"><li>启动选项：</li></ol><ul><li>忽略健康检查（环境慢/卡住时）：<div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">supabase start </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ignore</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">health</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">check</span></span></code></pre></div></li><li>排除部分服务（节省资源，示例排除镜像处理、邮件、Edge Runtime 等）：<div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">supabase start </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">x imgproxy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">inbucket</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">edge</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">runtime</span></span></code></pre></div>可用服务名以你的 CLI 版本为准（<code>supabase start --help</code> 查看），常见重量级：imgproxy, inbucket, edge-runtime, vector。</li></ul><ol start="3"><li>查看状态与端口：</li></ol><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">supabase status</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">docker ps</span></span></code></pre></div><p>默认常用端口（可能因版本略有不同）：</p><ul><li>Postgres: 54322</li><li>Studio: 54323</li><li>API: 54321</li></ul><p>如需排查端口占用：</p><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">netstat </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ano </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> findstr :</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">54322</span></span></code></pre></div><ol start="4"><li>查看日志（使用 Docker Desktop 或命令行）：</li></ol><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">docker logs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">容器名或ID</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><ol start="5"><li>停止与清理：</li></ol><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">supabase stop           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 停止并备份本地数据库</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">supabase stop </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">no</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">backup  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 停止且不备份</span></span></code></pre></div><h2 id="_6-数据库编辑与验证-优先使用-supabase-studio" tabindex="-1">6. 数据库编辑与验证：优先使用 Supabase Studio <a class="header-anchor" href="#_6-数据库编辑与验证-优先使用-supabase-studio" aria-label="Permalink to &quot;6. 数据库编辑与验证：优先使用 Supabase Studio&quot;">​</a></h2><ul><li>打开 Supabase Studio（本地）：<a href="http://localhost:54323" target="_blank" rel="noreferrer">http://localhost:54323</a></li><li>使用场景： <ul><li>Schema 设计（表、索引、视图、触发器、RLS 策略）</li><li>SQL Editor 验证与运行（例如 pgsodium 加/解密实验）</li><li>数据浏览与修改</li></ul></li><li>说明：在使用本地 Docker 环境时，Studio 已覆盖“编辑/查看”主要需求，无需 VSCode 数据库插件。</li></ul><h2 id="_7-迁移与云端同步-保证与云端项目一致" tabindex="-1">7. 迁移与云端同步（保证与云端项目一致） <a class="header-anchor" href="#_7-迁移与云端同步-保证与云端项目一致" aria-label="Permalink to &quot;7. 迁移与云端同步（保证与云端项目一致）&quot;">​</a></h2><ol><li>将本地更改固化为迁移：</li></ol><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">supabase db diff </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&lt;描述性名称&gt;&quot;</span></span></code></pre></div><p>生成 SQL 迁移文件于 supabase/migrations/。</p><ol start="2"><li>验证迁移可重放（推荐）：</li></ol><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">supabase db reset</span></span></code></pre></div><p>从零重建本地数据库并顺序执行全部迁移，验证无误。</p><ol start="3"><li>推送到云端（基于 link 绑定的项目）：</li></ol><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">supabase db push</span></span></code></pre></div><p>将未执行的迁移按顺序应用至云端数据库。</p><p>说明：</p><ul><li>init 只创建本地结构；link 才决定“与哪个云端项目关联”</li><li>start 只启动本地容器，不会“新建一个云端项目”</li><li>开发阶段可完全离线在本地进行；需要同步到云端时再 push</li></ul><h2 id="_8-补充" tabindex="-1">8. 补充 <a class="header-anchor" href="#_8-补充" aria-label="Permalink to &quot;8. 补充&quot;">​</a></h2><ul><li>包管理器 Scoop： <ul><li>安装路径：C:\\Users&lt;用户名&gt;\\scoop</li><li>更新：<code>scoop update supabase</code></li><li>卸载：<code>scoop uninstall supabase</code></li></ul></li><li>磁盘与内存： <ul><li>Docker 数据建议放至非 C 盘；保证 10–20 GB 以上可用空间</li><li>Docker Desktop → Resources 可调整 CPU/内存限制（按机器配置选择）</li></ul></li></ul>`,62)]))}const g=i(t,[["render",p]]);export{c as __pageData,g as default};
