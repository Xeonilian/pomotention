import{_ as i,c as a,o as l,ag as e}from"./chunks/framework.Cs5y-aXb.js";const c=JSON.parse('{"title":"帮助文档部署流程","description":"","frontmatter":{},"headers":[],"relativePath":"dev-log/SOP/docs-deployment.md","filePath":"dev-log/SOP/docs-deployment.md","lastUpdated":1767957301000}'),t={name:"dev-log/SOP/docs-deployment.md"};function n(p,s,h,o,d,r){return l(),a("div",null,s[0]||(s[0]=[e(`<h1 id="帮助文档部署流程" tabindex="-1">帮助文档部署流程 <a class="header-anchor" href="#帮助文档部署流程" aria-label="Permalink to &quot;帮助文档部署流程&quot;">​</a></h1><h2 id="概述" tabindex="-1">概述 <a class="header-anchor" href="#概述" aria-label="Permalink to &quot;概述&quot;">​</a></h2><p>帮助文档使用 VitePress 构建，支持三路部署方案：</p><ol><li><strong>GitHub Pages</strong>：部署到 <code>gh-pages</code> 分支，base: <code>/pomotention/</code></li><li><strong>Cloudflare Pages</strong>：部署到 <code>pomotention.pages.dev/help</code>，base: <code>/help</code></li><li><strong>本地 APP</strong>：Tauri 应用内嵌文档，使用相对路径 base: <code>/</code></li></ol><p>每次通过 Pull Request 合并到 <code>main</code> 分支时，GitHub Pages 和 Cloudflare Pages 会自动检测并部署更新。</p><p><strong>重要说明</strong>：</p><ul><li><strong>网页版</strong>：优先使用 Cloudflare Pages 在线文档（始终最新）</li><li><strong>桌面版（Tauri）</strong>：优先使用本地打包的文档（离线可用），fallback 到在线版本</li><li><strong>版本信息</strong>：直接写在页面上，不需要动态获取</li></ul><h2 id="文档结构" tabindex="-1">文档结构 <a class="header-anchor" href="#文档结构" aria-label="Permalink to &quot;文档结构&quot;">​</a></h2><ul><li><strong>文档目录</strong>：<code>docs/</code></li><li><strong>配置文件</strong>：<code>docs/.vitepress/config.mts</code></li><li><strong>构建输出</strong>：<code>docs/.vitepress/dist/</code></li><li><strong>访问地址</strong>： <ul><li>GitHub Pages: <a href="https://xeonilian.github.io/pomotention/" target="_blank" rel="noreferrer">https://xeonilian.github.io/pomotention/</a></li><li>Cloudflare Pages: <a href="https://pomotention.pages.dev/help/" target="_blank" rel="noreferrer">https://pomotention.pages.dev/help/</a></li><li>本地 APP: <code>./docs/index.html</code> (相对路径)</li></ul></li></ul><h2 id="多环境配置" tabindex="-1">多环境配置 <a class="header-anchor" href="#多环境配置" aria-label="Permalink to &quot;多环境配置&quot;">​</a></h2><h3 id="vitepress-配置" tabindex="-1">VitePress 配置 <a class="header-anchor" href="#vitepress-配置" aria-label="Permalink to &quot;VitePress 配置&quot;">​</a></h3><p>文档通过环境变量 <code>VITEPRESS_BASE</code> 动态设置 base 路径：</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// docs/.vitepress/config.mts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> base</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> process.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">VITEPRESS_BASE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/pomotention/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>各环境的 base 配置：</p><ul><li><strong>GitHub Pages</strong>: <code>/pomotention/</code> (默认)</li><li><strong>Cloudflare Pages</strong>: <code>/help</code></li><li><strong>本地 APP</strong>: <code>/</code> (相对路径)</li></ul><h3 id="构建脚本" tabindex="-1">构建脚本 <a class="header-anchor" href="#构建脚本" aria-label="Permalink to &quot;构建脚本&quot;">​</a></h3><p><code>docs/package.json</code> 中提供了多个构建脚本：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;scripts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;docs:dev&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;vitepress dev&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;docs:build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;vitepress build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// GitHub Pages (base: /pomotention/)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;docs:build:cloudflare&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;vitepress build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,         </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Cloudflare Pages (base: /help)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;docs:build:local&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;vitepress build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,              </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 本地 APP (base: /)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;docs:preview&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;vitepress preview&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;docs:deploy:github&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;vitepress build &amp;&amp; npx gh-pages -d .vitepress/dist&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>构建命令示例：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># GitHub Pages (默认)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docs:build</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Cloudflare Pages</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; VITEPRESS_BASE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/help</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docs:build:cloudflare</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 本地 APP</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; VITEPRESS_BASE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docs:build:local</span></span></code></pre></div><h2 id="本地开发" tabindex="-1">本地开发 <a class="header-anchor" href="#本地开发" aria-label="Permalink to &quot;本地开发&quot;">​</a></h2><h3 id="安装依赖" tabindex="-1">安装依赖 <a class="header-anchor" href="#安装依赖" aria-label="Permalink to &quot;安装依赖&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span></code></pre></div><h3 id="启动开发服务器" tabindex="-1">启动开发服务器 <a class="header-anchor" href="#启动开发服务器" aria-label="Permalink to &quot;启动开发服务器&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docs:dev</span></span></code></pre></div><p>开发服务器会在 <code>http://localhost:5173</code> 启动，支持热重载。</p><h3 id="预览构建结果" tabindex="-1">预览构建结果 <a class="header-anchor" href="#预览构建结果" aria-label="Permalink to &quot;预览构建结果&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 预览 GitHub Pages 版本</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docs:build</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docs:preview</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 预览 Cloudflare Pages 版本</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VITEPRESS_BASE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/help</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docs:build:cloudflare</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docs:preview</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 预览本地 APP 版本</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VITEPRESS_BASE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docs:build:local</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docs:preview</span></span></code></pre></div><h2 id="部署流程" tabindex="-1">部署流程 <a class="header-anchor" href="#部署流程" aria-label="Permalink to &quot;部署流程&quot;">​</a></h2><h3 id="_1-github-pages-部署" tabindex="-1">1. GitHub Pages 部署 <a class="header-anchor" href="#_1-github-pages-部署" aria-label="Permalink to &quot;1. GitHub Pages 部署&quot;">​</a></h3><p><strong>自动部署（推荐）</strong>：</p><ul><li>当 Pull Request 合并到 <code>main</code> 分支且包含 <code>docs/</code> 目录变更时，GitHub Actions 会自动触发</li><li>工作流文件：<code>.github/workflows/docs-deploy.yml</code></li><li>触发机制：PR 合并到 <code>main</code> 后，GitHub 会自动产生 <code>push</code> 事件，工作流监听 <code>push</code> 事件到 <code>main</code> 分支</li><li>构建命令：<code>cd docs &amp;&amp; pnpm install &amp;&amp; pnpm docs:build</code> (base: <code>/pomotention/</code>)</li><li>自动推送到 <code>gh-pages</code> 分支</li><li>访问地址：<a href="https://xeonilian.github.io/pomotention/" target="_blank" rel="noreferrer">https://xeonilian.github.io/pomotention/</a></li><li><strong>注意</strong>：虽然监听的是 <code>push</code> 事件，但由于分支保护规则，实际只能通过 PR 合并触发（符合分支保护要求）</li></ul><p><strong>手动部署</strong>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docs:deploy:github</span></span></code></pre></div><h3 id="_2-cloudflare-pages-部署" tabindex="-1">2. Cloudflare Pages 部署 <a class="header-anchor" href="#_2-cloudflare-pages-部署" aria-label="Permalink to &quot;2. Cloudflare Pages 部署&quot;">​</a></h3><p><strong>自动部署（推荐）</strong>：</p><ul><li>当 Pull Request 合并到 <code>main</code> 分支时，Cloudflare Pages 会自动检测并部署</li><li>在 Cloudflare Dashboard 中配置： <ul><li><strong>构建命令</strong>：<code>cd docs &amp;&amp; pnpm install &amp;&amp; VITEPRESS_BASE=/help pnpm docs:build:cloudflare</code></li><li><strong>构建输出目录</strong>：<code>docs/.vitepress/dist</code></li><li><strong>根目录</strong>：<code>/</code> (项目根目录)</li><li><strong>Node 版本</strong>：20</li><li><strong>环境变量</strong>：<code>VITEPRESS_BASE=/help</code></li><li><strong>自动部署触发</strong>：Pull Request 合并到 <code>main</code> 分支</li></ul></li><li>访问地址：<a href="https://pomotention.pages.dev/help/" target="_blank" rel="noreferrer">https://pomotention.pages.dev/help/</a></li></ul><p><strong>手动部署</strong>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docs</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VITEPRESS_BASE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/help</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docs:build:cloudflare</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 然后通过 Cloudflare Dashboard 或 wrangler 手动上传</span></span></code></pre></div><h3 id="_3-本地-app-内嵌文档" tabindex="-1">3. 本地 APP 内嵌文档 <a class="header-anchor" href="#_3-本地-app-内嵌文档" aria-label="Permalink to &quot;3. 本地 APP 内嵌文档&quot;">​</a></h3><p><strong>构建流程</strong>：</p><ol><li>在 Tauri 构建前，先构建文档（base: <code>/</code>）</li><li>将构建产物复制到 <code>public/docs/</code> 或 <code>dist/docs/</code></li><li>应用中的 <code>useDocsUrl.ts</code> 会自动使用本地文档路径</li></ol><p><strong>构建命令</strong>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 构建本地文档</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docs</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VITEPRESS_BASE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docs:build:local</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 复制到应用目录（示例）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docs/.vitepress/dist/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> public/docs/</span></span></code></pre></div><p><strong>注意事项</strong>：</p><ul><li>本地 APP 使用相对路径，确保离线可用</li><li>文档路径：<code>./docs/index.html</code></li><li>需要在 Tauri 构建流程中集成文档构建步骤</li></ul><h2 id="在应用中的使用" tabindex="-1">在应用中的使用 <a class="header-anchor" href="#在应用中的使用" aria-label="Permalink to &quot;在应用中的使用&quot;">​</a></h2><h3 id="文档-url-获取策略" tabindex="-1">文档 URL 获取策略 <a class="header-anchor" href="#文档-url-获取策略" aria-label="Permalink to &quot;文档 URL 获取策略&quot;">​</a></h3><p>应用通过 <code>src/composables/useDocsUrl.ts</code> 智能获取文档 URL：</p><p><strong>优先级顺序</strong>：</p><ol><li>开发模式：本地 VitePress 开发服务器 (<code>http://localhost:5173</code>)</li><li>生产模式（Tauri）：本地打包的文档 (<code>./docs/index.html</code>)</li><li>生产模式（Web）：在线版本（优先 Cloudflare Pages，fallback 到 GitHub Pages）</li></ol><h3 id="网页版" tabindex="-1">网页版 <a class="header-anchor" href="#网页版" aria-label="Permalink to &quot;网页版&quot;">​</a></h3><ul><li>使用 iframe 直接嵌入 Cloudflare Pages 文档</li><li>用户无需离开应用即可查看帮助</li><li>显示的是最新版本的文档</li></ul><h3 id="桌面版-tauri" tabindex="-1">桌面版（Tauri） <a class="header-anchor" href="#桌面版-tauri" aria-label="Permalink to &quot;桌面版（Tauri）&quot;">​</a></h3><ul><li><strong>优先使用本地打包的文档</strong>（离线可用）</li><li>如果本地文档不可用，fallback 到在线版本</li><li>顶部显示当前应用版本号（从 <code>package.json</code> 读取）</li><li>提供&quot;下载更新&quot;下拉菜单，支持多个下载源： <ul><li>GitHub Releases（默认）</li><li>码云 Gitee（备用，适合无法访问 GitHub 的用户）</li><li>可继续添加其他下载源</li></ul></li><li>提供&quot;查看源码&quot;按钮链接到 GitHub 仓库</li></ul><h2 id="注意事项" tabindex="-1">注意事项 <a class="header-anchor" href="#注意事项" aria-label="Permalink to &quot;注意事项&quot;">​</a></h2><ol><li><p><strong>路径一致性</strong>：确保各环境的 base 配置正确，避免资源加载失败</p><ul><li>GitHub Pages: <code>/pomotention/</code></li><li>Cloudflare Pages: <code>/help</code></li><li>本地 APP: <code>/</code> (相对路径)</li></ul></li><li><p><strong>构建顺序</strong>：本地 APP 构建时，先构建文档再构建应用</p></li><li><p><strong>缓存问题</strong>：Cloudflare Pages 可能需要配置缓存规则</p></li><li><p><strong>相对路径</strong>：本地 APP 使用相对路径，确保离线可用</p></li><li><p><strong>环境变量</strong>：构建时通过 <code>VITEPRESS_BASE</code> 环境变量设置 base 路径</p></li><li><p><strong>版本信息</strong>：</p><ul><li>不再动态获取版本号，直接从 <code>package.json</code> 读取</li><li>桌面版会在帮助页面顶部显示当前应用版本</li><li>版本号同步位置：<code>package.json</code>、<code>src-tauri/tauri.conf.json</code>、<code>src-tauri/Cargo.toml</code></li></ul></li><li><p><strong>下载源管理</strong>：</p><ul><li>在 <code>src/views/HelpView.vue</code> 中的 <code>downloadOptions</code> 配置下载源</li><li>目前支持：GitHub Releases、码云 Gitee</li><li>添加新下载源只需在配置数组中添加新项</li></ul></li><li><p><strong>CI 检查</strong>：GitHub Actions 会检查文档质量</p><ul><li>Markdown 语法检查</li><li>死链接检测</li><li>配置文件：<code>.github/workflows/docs-ci.yml</code></li></ul></li></ol><h2 id="故障排查" tabindex="-1">故障排查 <a class="header-anchor" href="#故障排查" aria-label="Permalink to &quot;故障排查&quot;">​</a></h2><h3 id="部署失败" tabindex="-1">部署失败 <a class="header-anchor" href="#部署失败" aria-label="Permalink to &quot;部署失败&quot;">​</a></h3><ol><li><p><strong>GitHub Pages</strong>：</p><ul><li>检查 <code>.github/workflows/docs-deploy.yml</code> 工作流状态</li><li>确认仓库设置中已启用 GitHub Pages</li><li>检查构建日志中的错误信息</li></ul></li><li><p><strong>Cloudflare Pages</strong>：</p><ul><li>检查 Cloudflare Dashboard 中的构建日志</li><li>确认构建命令和输出目录配置正确</li><li>检查环境变量 <code>VITEPRESS_BASE</code> 是否设置正确</li><li>检查 <code>docs/package.json</code> 中的依赖是否完整</li></ul></li></ol><h3 id="本地构建失败" tabindex="-1">本地构建失败 <a class="header-anchor" href="#本地构建失败" aria-label="Permalink to &quot;本地构建失败&quot;">​</a></h3><ol><li>确认 Node.js 版本为 20</li><li>清理并重新安装依赖：<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node_modules</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span></code></pre></div></li></ol><h3 id="文档未更新" tabindex="-1">文档未更新 <a class="header-anchor" href="#文档未更新" aria-label="Permalink to &quot;文档未更新&quot;">​</a></h3><ol><li>确认 Pull Request 已合并到 <code>main</code> 分支</li><li>检查 GitHub Actions 和 Cloudflare Dashboard 中的部署状态</li><li>清除浏览器缓存后刷新页面</li><li>检查 base 路径配置是否正确</li></ol><h3 id="资源加载失败" tabindex="-1">资源加载失败 <a class="header-anchor" href="#资源加载失败" aria-label="Permalink to &quot;资源加载失败&quot;">​</a></h3><ol><li>检查 <code>docs/.vitepress/config.mts</code> 中的 base 配置</li><li>确认各环境的 base 路径与部署路径一致</li><li>检查静态资源路径是否正确（logo、favicon 等）</li></ol><h2 id="发布流程总结" tabindex="-1">发布流程总结 <a class="header-anchor" href="#发布流程总结" aria-label="Permalink to &quot;发布流程总结&quot;">​</a></h2><h3 id="_1-更新文档内容" tabindex="-1">1. 更新文档内容 <a class="header-anchor" href="#_1-更新文档内容" aria-label="Permalink to &quot;1. 更新文档内容&quot;">​</a></h3><p>编辑 <code>docs/</code> 目录下的 Markdown 文件。</p><h3 id="_2-提交并推送" tabindex="-1">2. 提交并推送 <a class="header-anchor" href="#_2-提交并推送" aria-label="Permalink to &quot;2. 提交并推送&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docs/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> commit</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;docs: 更新帮助文档内容&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> origin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> main</span></span></code></pre></div><h3 id="_3-自动部署" tabindex="-1">3. 自动部署 <a class="header-anchor" href="#_3-自动部署" aria-label="Permalink to &quot;3. 自动部署&quot;">​</a></h3><ul><li><strong>GitHub Pages</strong>：GitHub Actions 会自动检测并部署，通常 2-3 分钟内完成</li><li><strong>Cloudflare Pages</strong>：Cloudflare 会自动检测并部署，通常 1-2 分钟内完成</li></ul><h3 id="_4-本地-app-文档更新-如需要" tabindex="-1">4. 本地 APP 文档更新（如需要） <a class="header-anchor" href="#_4-本地-app-文档更新-如需要" aria-label="Permalink to &quot;4. 本地 APP 文档更新（如需要）&quot;">​</a></h3><p>如果同时发布新版本的应用：</p><ol><li><p>构建本地文档：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docs</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VITEPRESS_BASE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docs:build:local</span></span></code></pre></div></li><li><p>复制文档到应用目录：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docs/.vitepress/dist/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> public/docs/</span></span></code></pre></div></li><li><p>更新应用版本号：</p><ul><li><code>package.json</code></li><li><code>src-tauri/tauri.conf.json</code></li><li><code>src-tauri/Cargo.toml</code></li></ul></li><li><p>构建并发布应用：</p><ul><li>参考 <code>docs/dev-log/SOP/release.md</code></li></ul></li><li><p>上传到多个平台：</p><ul><li>GitHub Releases（必需）</li><li>码云 Gitee（可选，适合国内用户）</li></ul></li></ol><h2 id="相关文件" tabindex="-1">相关文件 <a class="header-anchor" href="#相关文件" aria-label="Permalink to &quot;相关文件&quot;">​</a></h2><ul><li><code>docs/package.json</code> - 文档项目的依赖和脚本</li><li><code>docs/.vitepress/config.mts</code> - VitePress 配置文件（支持环境变量）</li><li><code>.github/workflows/docs-deploy.yml</code> - GitHub Pages 部署工作流</li><li><code>src/composables/useDocsUrl.ts</code> - 文档 URL 获取逻辑（支持三路部署）</li><li><code>src/views/HelpView.vue</code> - 应用中的帮助页面组件</li><li><code>.github/workflows/docs-ci.yml</code> - 文档 CI 检查工作流</li><li><code>docs/dev-log/SOP/release.md</code> - 应用发布流程</li></ul>`,78)]))}const g=i(t,[["render",n]]);export{c as __pageData,g as default};
